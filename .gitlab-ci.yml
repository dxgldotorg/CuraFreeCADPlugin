stages:
  - verify
  - build

variables:
  GIT_SUBMODULE_STRATEGY: recursive
  PYCODESTYLE_ARGS: --max-line-length=120 --exclude=./*/CadIntegrationUtils/3rd-party/*

codestyle-pep8:
  stage: verify
  tags:
    - os:ubuntu
    - package:pycodestyle
    - type:shell
  script:
    - pycodestyle --show-source --show-pep8 ${PYCODESTYLE_ARGS} . || pycodestyle --statistics ${PYCODESTYLE_ARGS} -q .
  only:
    - triggers
    - branches
    - tags

package:
  stage: build
  tags:
    - os:ubuntu
    - package:python3
    - type:shell
  script:
    - curl https://git.thopiekar.eu/Cura/plugins/CuraPluginOven/raw/deployment/cpo.py?inline=false --output cpo.py
    - python3 ./cpo.py --create=package610 --source=./
    - python3 ./cpo.py --create=package600 --source=./
    - python3 ./cpo.py --create=source --source=./
  only:
    - triggers
    - branches
    - tags
  artifacts:
    paths:
      - ./*.curapackage
      - ./*.curaplugin
      - ./*.umplugin
      - ./*.zip
